# 03. 서비스 방향성 및 데이터 전략

## 개요

DailyStock 서비스의 데이터 제공 전략과 서비스 구조를 정의합니다. 한국 주식 시세 데이터의 법적 재배포 제약을 고려하여, 자체 분석 콘텐츠와 외부 위젯을 조합한 하이브리드 구조를 채택합니다.

---

## 1. 배경 및 제약사항

### 한국 주식 시세 데이터 재배포 현황

| 데이터 소스                 | 무료             | 데이터 속도  | 외부 공개(재배포) |
| --------------------------- | ---------------- | ------------ | ----------------- |
| 공공데이터포털 (금융위원회) | O                | D+1 오후 1시 | O                 |
| 증권사 API (한투, 키움 등)  | O                | 실시간       | X (개인용도 한정) |
| 코스콤 시세 라이선스        | X (유료, 법인만) | 실시간       | O (계약 후)       |
| 네이버/다음 금융 크롤링     | O                | 실시간       | X (법적 리스크)   |

### 핵심 제약

- **KRX 시세 데이터 재배포**는 코스콤 라이선스 계약이 필수 (법인만 가능, 비용 비공개)
- **공공데이터포털**이 유일하게 무료 + 재배포 가능하지만, **영업일 D+1 오후 1시** 갱신
- 증권사 API는 무료이나 **개인용도 한정**, 외부 서비스에 시세 재공개 불가

### 결론

실시간 시세는 **TradingView 임베드 위젯**으로 해결하고, 자체 DB 시세 데이터는 **공공데이터포털**을 유지합니다.

---

## 2. 기능별 데이터 소스 전략

### 2.1 데이터 소스 분리 원칙

| 기능             | 데이터 소스               | 데이터 시점    | 비고                            |
| ---------------- | ------------------------- | -------------- | ------------------------------- |
| 실시간 시세/차트 | TradingView 위젯 (임베드) | 실시간         | 보여주기 전용, 데이터 추출 불가 |
| AI 종목 분석     | 공공데이터포털 (자체 DB)  | 전일 마감 기준 | "전일 마감 기준 분석" 명시      |
| 오후 리포트      | 공공데이터포털 (자체 DB)  | 전일 마감 기준 | "전일 마감 기준 분석" 명시      |
| 기업 정보        | 공공데이터포털 (자체 DB)  | 비정기 갱신    | 업종, 대표자, 설립일 등         |
| 뉴스 감성 분석   | 뉴스 API (TBD)            | 실시간         | AI 자체 분석 콘텐츠             |

> **중요**: TradingView 위젯은 iframe 임베드로 시세를 **화면에 표시**할 뿐, 위젯 내 데이터를 추출하여 AI 분석이나 리포트에 활용할 수 없습니다. AI 분석 및 리포트에 사용되는 시세 데이터는 모두 **공공데이터포털의 전일 마감 데이터**입니다.

### 2.2 사용자 관점 데이터 흐름

```
사용자가 종목 상세 페이지 진입
│
├─ 실시간 시세/차트 확인
│   └─ TradingView 위젯 (실시간)
│
├─ AI 종목 분석 확인
│   └─ 자체 DB (전일 마감 기준)
│   └─ 표시: "2026-01-26 마감 기준 분석"
│
└─ 기업 정보 확인
    └─ 자체 DB (공공데이터포털)
```

### 2.3 종목 상세 페이지 구조

```
┌─────────────────────────────────────────────────┐
│                  종목 상세 페이지                    │
├─────────────────────────────────────────────────┤
│                                                   │
│  ┌─ 실시간 시세/차트 ──────────────────────────┐  │
│  │  TradingView 위젯 (임베드)                   │  │
│  │  - 실시간 또는 15분 지연 시세                   │  │
│  │  - 차트, 호가, 거래량                         │  │
│  │  - 라이선스: TradingView 보유 (재배포 아님)    │  │
│  └───────────────────────────────────────────┘  │
│                                                   │
│  ┌─ AI 종목 분석 ──────────────────────────────┐  │
│  │  자체 DB + AI (전일 마감 기준)                 │  │
│  │  - "2026-01-26 마감 기준 분석"                │  │
│  │  - AI 기반 종목 인사이트                       │  │
│  │  - 뉴스 감성 점수 (긍정/부정/중립)              │  │
│  │  - 핵심 이슈 요약                             │  │
│  └───────────────────────────────────────────┘  │
│                                                   │
│  ┌─ 기업 정보 ─────────────────────────────────┐  │
│  │  자체 DB (공공데이터포털)                      │  │
│  │  - 업종, 대표자, 설립일, 시가총액 등            │  │
│  │  - 전일 시세 요약 (종가, 등락률, 거래량)        │  │
│  └───────────────────────────────────────────┘  │
│                                                   │
└─────────────────────────────────────────────────┘
```

### 2.2 매일 오후 리포트

```
┌─────────────────────────────────────────────────┐
│          매일 오후 2시 리포트 (자동 발행)            │
├─────────────────────────────────────────────────┤
│                                                   │
│  데이터 흐름:                                      │
│  D일 장 마감 (15:30)                               │
│    → D+1 오후 1시: 공공데이터포털 갱신              │
│    → D+1 오후 1시 30분: 데이터 동기화 실행          │
│    → D+1 오후 2시: 리포트 생성 및 발행              │
│                                                   │
│  리포트 내용:                                      │
│  ├── 전일 시장 분석 (KOSPI/KOSDAQ 동향)            │
│  ├── 업종별 등락 현황                               │
│  ├── AI 뉴스 감성 분석 종합                         │
│  ├── 주요 종목 인사이트                             │
│  └── 투자 참고 포인트                               │
│                                                   │
│  활용:                                             │
│  - 장 마감(15:30) 전 1시간 30분 활용 가능           │
│  - 당일 매매 판단 참고 자료                         │
│                                                   │
└─────────────────────────────────────────────────┘
```

---

## 3. 데이터 동기화 스케줄

### 3.1 GitHub Actions 워크플로우

```yaml
# .github/workflows/sync-stocks.yml
on:
  schedule:
    # 평일 한국시간 오후 1시 30분 (UTC 04:30)
    # 공공데이터포털 갱신(오후 1시) 직후 실행
    - cron: '30 4 * * 1-5'
  workflow_dispatch: # 수동 실행 지원
```

### 3.2 동기화 타임라인

| 시간 (KST) | 이벤트                                 |
| ---------- | -------------------------------------- |
| D일 15:30  | 장 마감                                |
| D+1 13:00  | 공공데이터포털 D일 데이터 갱신         |
| D+1 13:30  | GitHub Actions 데이터 동기화 실행      |
| D+1 14:00  | 리포트 생성 및 발행                    |
| D+1 15:30  | 장 마감 (리포트 활용 가능 시간: ~1.5h) |

### 3.3 동기화 대상

| 데이터               | 소스           | 동기화 주기        | 용도             |
| -------------------- | -------------- | ------------------ | ---------------- |
| 종목 목록 (KRX 상장) | 공공데이터포털 | 매 영업일          | 종목 DB 최신화   |
| 전일 시세            | 공공데이터포털 | 매 영업일          | 리포트, 기업정보 |
| 기업 기본정보        | 공공데이터포털 | 비정기 (신규 종목) | 기업 상세 페이지 |
| 뉴스 데이터          | 뉴스 API (TBD) | 실시간             | AI 감성 분석     |

---

## 4. TradingView 위젯 연동

### 4.1 사용 위젯

| 위젯            | 용도                  | 페이지    |
| --------------- | --------------------- | --------- |
| Advanced Chart  | 종목 상세 차트        | 종목 상세 |
| Symbol Overview | 종목 요약 정보        | 종목 상세 |
| Ticker Tape     | 주요 종목 실시간 시세 | 메인/헤더 |
| Market Overview | 시장 전체 현황        | 메인      |

### 4.2 임베드 예시

```tsx
// widgets/stock-chart/ui/stock-chart.tsx
interface StockChartProps {
  symbol: string // KRX 종목코드 (예: "005930")
}

export function StockChart({ symbol }: StockChartProps) {
  return (
    <iframe
      src={`https://s.tradingview.com/widgetembed/?symbol=KRX:${symbol}&interval=D&theme=light&locale=kr`}
      width="100%"
      height="400"
      frameBorder="0"
      allowTransparency
    />
  )
}
```

### 4.3 라이선스

- 본 서비스는 **비상업적 개인 프로젝트**로 운영
- TradingView 위젯은 **무료 사용 가능** (attribution 필요)
- TradingView 브랜딩/로고 **반드시 유지** (제거 불가)
- 시세 데이터 라이선스는 TradingView가 보유
- 우리 서비스는 위젯을 임베드할 뿐 데이터를 재배포하지 않음

---

## 5. 서비스명 변경 검토

### 변경 사유

- 현재 "DailyStock"은 "매일 아침 리포트" 뉘앙스
- 오후 2시 리포트 모델로 전환 시 서비스명과 불일치
- 추후 서비스 콘셉트 확정 후 변경 예정

### 후보 방향 (미확정)

- 분석/인사이트 강조: 시간대보다 가치 제안 중심 네이밍
- 서비스명 확정은 MVP 이후 결정

---

## 6. 전체 아키텍처 요약

```
┌──────────────────────────────────────────────────────────┐
│                      DailyStock 서비스                     │
├──────────────────────────────────────────────────────────┤
│                                                            │
│  ┌─ 자체 데이터 (공공데이터포털) ──────────────────────┐  │
│  │  • 종목 목록, 기업 정보, 전일 시세                    │  │
│  │  • 동기화: 매 영업일 오후 1시 30분                    │  │
│  │  • 재배포: 허용 (공공데이터)                          │  │
│  └──────────────────────────────────────────────────┘  │
│                                                            │
│  ┌─ 실시간 시세 (TradingView 위젯) ──────────────────┐  │
│  │  • 종목 차트, 호가, 거래량                           │  │
│  │  • 방식: iframe 임베드 (재배포 아님)                  │  │
│  │  • 비용: 무료 (attribution 필요)                     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                            │
│  ┌─ AI 분석 (자체 개발) ─────────────────────────────┐  │
│  │  • 뉴스 감성 분석                                    │  │
│  │  • 매일 오후 2시 리포트                               │  │
│  │  • 종목 인사이트                                     │  │
│  └──────────────────────────────────────────────────┘  │
│                                                            │
└──────────────────────────────────────────────────────────┘
```

---

## 체크리스트

### 데이터 동기화

- [ ] GitHub Actions 스케줄을 오후 1시 30분(KST)으로 변경
- [ ] 동기화 완료 후 리포트 생성 트리거 구현

### TradingView 위젯

- [ ] TradingView 이용약관 확인 (상업적 사용)
- [ ] 종목 상세 페이지에 Advanced Chart 위젯 임베드
- [ ] 메인 페이지에 Market Overview 위젯 임베드
- [ ] KRX 종목코드 → TradingView 심볼 매핑

### AI 분석

- [ ] 뉴스 수집 API 선정 (별도 스펙)
- [ ] AI 감성 분석 파이프라인 설계 (별도 스펙)
- [ ] 오후 리포트 생성 로직 구현 (별도 스펙)

### 서비스명

- [ ] 서비스 콘셉트 확정 후 네이밍 변경 검토

---

## 참고 자료

- [공공데이터포털 - 주식시세정보](https://www.data.go.kr/data/15094808/openapi.do)
- [코스콤 오픈API 시세 서비스](https://koscom.gitbook.io/open-api/api/marketv3)
- [코스콤 오픈API 이용대상 및 수수료](https://koscom.gitbook.io/open-api/how-to-use/procedure/charge)
- [KRX 정보데이터시스템 - 구입안내](https://data.krx.co.kr/contents/MDC/DATA/datasale/index.cmd?viewNm=MDCDATA001)
- [TradingView 위젯](https://www.tradingview.com/widget/)
- [TradingView 이용약관](https://www.tradingview.com/policies/)
