# AI 공시 분석기 (AI Disclosure Analyzer)

> 어려운 공시, AI가 쉽게 풀어드려요

---

## 1. 프로젝트 개요

### 1.1 목적

- 복잡한 기업 공시를 AI가 쉽게 해석
- 관심 종목의 새 공시 발생 시 즉시 알림
- 기업 재무 데이터 기반 AI 분석 리포트 자동 생성

### 1.2 대상 사용자

- 공시 읽기 어려운 개인 투자자
- 여러 종목을 추적하는 투자자
- 기업 분석에 시간을 아끼고 싶은 사람

### 1.3 핵심 가치

- **쉽게**: AI가 공시를 3줄로 요약
- **빠르게**: 새 공시 발생 시 즉시 알림
- **똑똑하게**: 재무 데이터 기반 종합 분석

### 1.4 데이터 소스

| 소스          | 용도                                      | 갱신      |
| ------------- | ----------------------------------------- | --------- |
| DART Open API | 공시 목록, 공시 원문, 재무제표, 기업 정보 | 제출 즉시 |

---

## 2. 핵심 기능

### 2.1 관심 종목 관리

| 기능           | 설명                         |
| -------------- | ---------------------------- |
| 종목 검색      | 종목명/종목코드로 검색       |
| 관심 종목 등록 | 최대 20개 종목 등록          |
| 알림 설정      | 종목별 공시 유형 알림 ON/OFF |
| 우선순위 설정  | 중요 종목 상단 고정          |

### 2.2 공시 모니터링 & AI 해석

#### 2.2.1 실시간 공시 감지 (준실시간)

- n8n으로 5분마다 DART API 폴링
- 관심 종목의 새 공시 감지
- 새 공시 발생 시 AI 분석 자동 실행

#### 2.2.2 AI 공시 해석

| 항목           | 설명                                 |
| -------------- | ------------------------------------ |
| 3줄 요약       | 공시 핵심 내용 요약                  |
| 호재/악재 판단 | AI가 투자자 관점에서 판단            |
| 핵심 수치      | 중요 숫자 하이라이트 (매출, 이익 등) |
| 용어 설명      | 어려운 금융 용어 쉽게 풀이           |

#### 2.2.3 공시 유형별 분석

```
📋 정기보고서 (사업/분기/반기)
   → 실적 요약, 전년 대비 비교, 성장률 분석

📢 주요사항보고
   → 이슈 요약, 주가 영향 예상

💰 지분공시
   → 누가 얼마나 샀는지, 의미 해석

📈 증권신고서
   → 유상증자/CB 발행 등 자금조달 분석
```

### 2.3 기업 분석 리포트

#### 2.3.1 기업 개요 리포트

- 기업 기본 정보 (업종, 설립일, 종업원수)
- 사업 내용 요약
- 최대주주 현황

#### 2.3.2 재무 분석 리포트

| 항목         | 내용                                 |
| ------------ | ------------------------------------ |
| 실적 요약    | 최근 4분기 매출/영업이익/순이익 추이 |
| 수익성 분석  | 영업이익률, 순이익률, ROE            |
| 안정성 분석  | 부채비율, 유동비율, 이자보상배율     |
| 성장성 분석  | 매출성장률, 이익성장률               |
| AI 종합 의견 | 재무 상태 총평 + 투자 포인트         |

#### 2.3.3 배당 분석 리포트

- 최근 5년 배당금 추이
- 배당수익률, 배당성향
- AI 배당 매력도 평가

#### 2.3.4 비교 분석 리포트

- 동종 업계 기업과 재무 지표 비교
- 내 관심 종목 간 비교

### 2.4 알림 시스템

| 채널      | 내용                        |
| --------- | --------------------------- |
| 인앱 알림 | 대시보드에서 확인           |
| 텔레그램  | 새 공시 + AI 요약 즉시 전송 |
| 이메일    | 일일/주간 리포트 발송       |

### 2.5 AI 질문하기

- 특정 공시 선택 → "이게 무슨 뜻이야?" 질문
- 대화형으로 공시 내용 설명
- 추가 궁금한 점 자유롭게 질문

---

## 3. 화면 구성

### 3.1 페이지 목록

```
/                       → 대시보드
/watchlist              → 관심 종목 목록
/watchlist/add          → 종목 검색 & 추가
/stock/[code]           → 종목 상세 (공시 + 리포트)
/stock/[code]/report    → AI 기업 분석 리포트
/disclosure/[id]        → 공시 상세 + AI 해석
/disclosure/[id]/chat   → AI 질문하기
/notifications          → 알림 목록
/settings               → 설정 (알림 채널, 주기 등)
```

### 3.2 화면별 상세

#### 3.2.1 대시보드 (/)

```
┌─────────────────────────────────────────────────┐
│  AI 공시 분석기                      [설정] [알림]│
├─────────────────────────────────────────────────┤
│                                                 │
│  🔔 오늘의 새 공시 (3건)                         │
│  ─────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────┐   │
│  │ 🏢 삼성전자                    10분 전   │   │
│  │ 분기보고서 (2024.03)                     │   │
│  │                                         │   │
│  │ 💡 AI 요약                               │   │
│  │ "매출 74조원으로 전년 대비 12% 증가.     │   │
│  │  반도체 부문 회복세 뚜렷. 영업이익률     │   │
│  │  개선되며 시장 기대치 상회."             │   │
│  │                                         │   │
│  │ 📊 호재 가능성 높음              [자세히]│   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ 🏢 카카오                       2시간 전  │   │
│  │ 주요사항보고서 (타법인주식취득)           │   │
│  │ 💡 "AI 스타트업 A사 지분 30% 인수..."    │   │
│  │ 📊 중립                          [자세히]│   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ──────────────────────────────────────────── │
│                                                 │
│  ⭐ 내 관심 종목                                 │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │ 삼성전자  │ │ 카카오   │ │ 네이버   │       │
│  │ 새공시 1 │ │ 새공시 1 │ │ -        │       │
│  └──────────┘ └──────────┘ └──────────┘       │
│                                                 │
│  [+ 관심 종목 추가]                              │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.2 종목 상세 (/stock/[code])

```
┌─────────────────────────────────────────────────┐
│  ← 삼성전자 (005930)                    ⭐ 관심  │
├─────────────────────────────────────────────────┤
│                                                 │
│  [공시 목록]  [AI 리포트]  [재무제표]            │
│  ─────────────────────────────────────────────  │
│                                                 │
│  📋 최근 공시                                    │
│  ┌─────────────────────────────────────────┐   │
│  │ 2024.01.30  분기보고서 (2024.03)        │   │
│  │ 💡 매출 74조, 영업이익 6.5조 (호재)      │   │
│  ├─────────────────────────────────────────┤   │
│  │ 2024.01.15  주요사항보고서               │   │
│  │ 💡 자사주 5000억 취득 결정 (호재)        │   │
│  ├─────────────────────────────────────────┤   │
│  │ 2024.01.10  지분변동보고                 │   │
│  │ 💡 외국인 지분율 52% → 53% (중립)        │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  [공시 더보기]                                   │
│                                                 │
│  ──────────────────────────────────────────── │
│                                                 │
│  📊 빠른 재무 요약                               │
│  ┌───────────┬───────────┬───────────┐        │
│  │ 매출액     │ 영업이익   │ 순이익    │        │
│  │ 74조      │ 6.5조     │ 5.2조    │        │
│  │ +12% ▲   │ +45% ▲   │ +38% ▲  │        │
│  └───────────┴───────────┴───────────┘        │
│                                                 │
│  [AI 기업분석 리포트 생성하기]                    │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.3 AI 기업 분석 리포트 (/stock/[code]/report)

```
┌─────────────────────────────────────────────────┐
│  ← 삼성전자 AI 분석 리포트                       │
│     생성일: 2024.01.30                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  📌 기업 개요                                    │
│  ─────────────────────────────────────────────  │
│  업종: 반도체, 전자부품 제조                      │
│  설립: 1969년 | 종업원: 약 12만명                │
│  최대주주: 이재용 (17.5%)                        │
│                                                 │
│  💰 실적 분석                                    │
│  ─────────────────────────────────────────────  │
│                                                 │
│  [매출 추이 차트 - 최근 4분기]                   │
│  ┌─────────────────────────────────────────┐   │
│  │    ■                                    │   │
│  │ ■  ■  ■                                 │   │
│  │ Q1 Q2 Q3 Q4                             │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  • 매출액: 74조원 (YoY +12%)                    │
│  • 영업이익: 6.5조원 (YoY +45%)                 │
│  • 영업이익률: 8.8% (전분기 6.1%에서 개선)       │
│                                                 │
│  📈 수익성 지표                                  │
│  ─────────────────────────────────────────────  │
│  • ROE: 8.5% (업계 평균 6.2% 대비 양호)          │
│  • 순이익률: 7.0%                               │
│                                                 │
│  🏦 안정성 지표                                  │
│  ─────────────────────────────────────────────  │
│  • 부채비율: 35% (매우 안정적)                   │
│  • 유동비율: 245% (단기 지급능력 우수)           │
│                                                 │
│  💵 배당 분석                                    │
│  ─────────────────────────────────────────────  │
│  • 주당배당금: 1,444원                          │
│  • 배당수익률: 2.1%                             │
│  • 배당성향: 25%                                │
│                                                 │
│  🤖 AI 종합 의견                                 │
│  ─────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────┐   │
│  │ "반도체 업황 회복과 함께 실적 턴어라운드  │   │
│  │  진행 중. 영업이익률 개선이 두드러지며,   │   │
│  │  메모리 가격 상승 수혜 예상.              │   │
│  │                                         │   │
│  │  재무 안정성 우수하고 배당도 꾸준함.      │   │
│  │  다만, 글로벌 경기 불확실성과 경쟁 심화는 │   │
│  │  리스크 요인.                            │   │
│  │                                         │   │
│  │  💡 투자 포인트: 반도체 슈퍼사이클 수혜,  │   │
│  │     파운드리 성장, HBM 시장 확대"         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  [PDF 다운로드]  [리포트 새로고침]               │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.4 공시 상세 + AI 해석 (/disclosure/[id])

```
┌─────────────────────────────────────────────────┐
│  ← 삼성전자 분기보고서 (2024.03)                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  📄 공시 정보                                    │
│  접수일: 2024.01.30 16:30                       │
│  보고서: 분기보고서 (2024.03)                    │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  🤖 AI 해석                                      │
│  ┌─────────────────────────────────────────┐   │
│  │                                         │   │
│  │ 📊 판단: 호재 가능성 높음                 │   │
│  │                                         │   │
│  │ 📝 3줄 요약                              │   │
│  │ 1. 매출 74조원으로 전년 동기 대비 12%    │   │
│  │    증가, 시장 예상치 상회                 │   │
│  │ 2. 반도체 부문 영업이익 4조원으로        │   │
│  │    전분기 대비 2배 이상 증가              │   │
│  │ 3. 메모리 가격 상승 효과로 수익성 대폭   │   │
│  │    개선, 연간 실적 기대감 상승            │   │
│  │                                         │   │
│  │ 💡 핵심 수치                              │   │
│  │ • 매출액: 74조원 (+12% YoY)              │   │
│  │ • 영업이익: 6.5조원 (+45% YoY)           │   │
│  │ • 반도체 매출: 25조원 (+28% YoY)         │   │
│  │                                         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  [AI에게 질문하기]  [원문 보기 (DART)]           │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.5 AI 질문하기 (/disclosure/[id]/chat)

```
┌─────────────────────────────────────────────────┐
│  ← 삼성전자 분기보고서 - AI 질문                 │
├─────────────────────────────────────────────────┤
│                                                 │
│  🤖 이 공시에 대해 궁금한 게 있으면 물어보세요!  │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  👤 영업이익이 많이 늘었는데, 왜 그런 거야?      │
│                                                 │
│  🤖 좋은 질문이야! 영업이익이 45%나 늘어난      │
│     이유는 크게 두 가지야:                       │
│                                                 │
│     1. 메모리 반도체 가격 상승                   │
│        DRAM 가격이 전분기 대비 15% 올랐어.      │
│        삼성전자는 메모리 점유율 1위라서          │
│        가격 상승 효과를 제일 많이 받았지.        │
│                                                 │
│     2. 원가 절감 노력                            │
│        생산 효율화로 원가율이 2%p 개선됐어.      │
│                                                 │
│     결국 "팔린 양 × 단가"가 모두 좋아진 거지!   │
│                                                 │
│  ─────────────────────────────────────────────  │
│                                                 │
│  👤 그럼 다음 분기도 좋을까?                     │
│                                                 │
│  🤖 음, 몇 가지 체크포인트가 있어:               │
│                                                 │
│     ✅ 긍정적 요인                               │
│     • 메모리 가격 상승 추세 지속 전망            │
│     • AI 서버용 HBM 수요 폭발                   │
│                                                 │
│     ⚠️ 주의할 점                                │
│     • 중국 경기 불확실성                         │
│     • 환율 변동 리스크                          │
│                                                 │
│     개인적인 의견이지만, 업황 자체는 좋아서      │
│     급격한 악화는 어려울 것 같아.                │
│                                                 │
│  ┌─────────────────────────────────────────┐   │
│  │ HBM이 뭐야?                              │   │
│  └─────────────────────────────────────────┘   │
│                                      [전송]     │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### 3.2.6 관심 종목 추가 (/watchlist/add)

```
┌─────────────────────────────────────────────────┐
│  ← 관심 종목 추가                                │
├─────────────────────────────────────────────────┤
│                                                 │
│  🔍 종목 검색                                    │
│  ┌─────────────────────────────────────────┐   │
│  │ 삼성                                    │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  검색 결과                                       │
│  ┌─────────────────────────────────────────┐   │
│  │ 삼성전자 (005930)              [+ 추가] │   │
│  │ 코스피 | 반도체                          │   │
│  ├─────────────────────────────────────────┤   │
│  │ 삼성SDI (006400)               [+ 추가] │   │
│  │ 코스피 | 2차전지                         │   │
│  ├─────────────────────────────────────────┤   │
│  │ 삼성바이오로직스 (207940)      [+ 추가] │   │
│  │ 코스피 | 바이오                          │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
└─────────────────────────────────────────────────┘
```

---

## 4. 기술 스택

### 4.1 프론트엔드

| 기술         | 용도        |
| ------------ | ----------- |
| Next.js      | 프레임워크  |
| Tailwind CSS | 스타일링    |
| shadcn/ui    | UI 컴포넌트 |

### 4.2 백엔드

| 기술               | 용도                                   |
| ------------------ | -------------------------------------- |
| Next.js API Routes | 가벼운 API (CRUD, 검색)                |
| n8n                | 무거운 작업 (공시 폴링, AI 분석, 알림) |

### 4.3 데이터베이스

| 기술     | 용도                         |
| -------- | ---------------------------- |
| Supabase | PostgreSQL + 인증 + 스토리지 |

### 4.4 AI

| 기술       | 용도                              |
| ---------- | --------------------------------- |
| Gemini API | 공시 해석, 리포트 생성, 질문 응답 |

### 4.5 외부 API

| 소스          | 용도                                     |
| ------------- | ---------------------------------------- |
| DART Open API | 공시 목록, 공시 원문, 재무제표, 기업정보 |

### 4.6 알림

| 채널     | 기술                |
| -------- | ------------------- |
| 텔레그램 | Telegram Bot API    |
| 이메일   | Resend / Nodemailer |

### 4.7 배포

| 기술    | 용도      |
| ------- | --------- |
| AWS EC2 | 서버 배포 |

---

## 5. 데이터베이스 스키마

### 5.1 users (사용자)

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email VARCHAR(255) UNIQUE NOT NULL,
  nickname VARCHAR(50),
  telegram_chat_id VARCHAR(50),          -- 텔레그램 알림용
  notification_email BOOLEAN DEFAULT true,
  notification_telegram BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 5.2 stocks (종목 정보)

```sql
CREATE TABLE stocks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  stock_code VARCHAR(10) UNIQUE NOT NULL,  -- 종목코드 (005930)
  corp_code VARCHAR(10) UNIQUE NOT NULL,   -- DART 고유번호 (8자리)
  corp_name VARCHAR(100) NOT NULL,         -- 기업명
  market VARCHAR(20),                      -- KOSPI, KOSDAQ, KONEX
  sector VARCHAR(100),                     -- 업종
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 5.3 watchlist (관심 종목)

```sql
CREATE TABLE watchlist (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  stock_id UUID REFERENCES stocks(id) ON DELETE CASCADE,

  -- 알림 설정
  notify_regular BOOLEAN DEFAULT true,     -- 정기보고서
  notify_major BOOLEAN DEFAULT true,       -- 주요사항보고
  notify_equity BOOLEAN DEFAULT true,      -- 지분공시
  notify_securities BOOLEAN DEFAULT false, -- 증권신고서

  priority INTEGER DEFAULT 0,              -- 우선순위 (정렬용)
  created_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(user_id, stock_id)
);
```

### 5.4 disclosures (공시)

```sql
CREATE TABLE disclosures (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  stock_id UUID REFERENCES stocks(id) ON DELETE CASCADE,

  -- DART 공시 정보
  rcept_no VARCHAR(20) UNIQUE NOT NULL,    -- 접수번호
  rcept_dt DATE NOT NULL,                  -- 접수일자
  report_nm VARCHAR(500) NOT NULL,         -- 보고서명
  dcm_type VARCHAR(10),                    -- 공시유형 (A:정기, B:주요, C:발행, D:지분, E:기타)

  -- 원문 링크
  dart_url VARCHAR(500),

  -- AI 분석 결과
  ai_summary TEXT,                         -- 3줄 요약
  ai_sentiment VARCHAR(20),                -- 호재/악재/중립
  ai_key_figures JSONB,                    -- 핵심 수치
  ai_analysis TEXT,                        -- 상세 분석
  ai_analyzed_at TIMESTAMP,

  created_at TIMESTAMP DEFAULT NOW()
);
```

### 5.5 financial_data (재무 데이터)

```sql
CREATE TABLE financial_data (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  stock_id UUID REFERENCES stocks(id) ON DELETE CASCADE,

  -- 기간 정보
  bsns_year VARCHAR(4) NOT NULL,           -- 사업연도
  reprt_code VARCHAR(10) NOT NULL,         -- 보고서코드 (11013:1분기, 11012:반기, 11014:3분기, 11011:사업)

  -- 재무 데이터
  revenue BIGINT,                          -- 매출액
  operating_profit BIGINT,                 -- 영업이익
  net_income BIGINT,                       -- 당기순이익
  total_assets BIGINT,                     -- 자산총계
  total_liabilities BIGINT,                -- 부채총계
  total_equity BIGINT,                     -- 자본총계

  -- 상세 데이터 (JSON)
  raw_data JSONB,

  created_at TIMESTAMP DEFAULT NOW(),

  UNIQUE(stock_id, bsns_year, reprt_code)
);
```

### 5.6 ai_reports (AI 분석 리포트)

```sql
CREATE TABLE ai_reports (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  stock_id UUID REFERENCES stocks(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,

  report_type VARCHAR(20) NOT NULL,        -- FULL, FINANCIAL, DIVIDEND
  report_content JSONB NOT NULL,           -- 리포트 전체 내용

  created_at TIMESTAMP DEFAULT NOW()
);
```

### 5.7 ai_conversations (AI 대화)

```sql
CREATE TABLE ai_conversations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  disclosure_id UUID REFERENCES disclosures(id) ON DELETE CASCADE,

  role VARCHAR(20) NOT NULL,               -- USER, ASSISTANT
  content TEXT NOT NULL,

  created_at TIMESTAMP DEFAULT NOW()
);
```

### 5.8 notifications (알림 기록)

```sql
CREATE TABLE notifications (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  disclosure_id UUID REFERENCES disclosures(id),

  title VARCHAR(200) NOT NULL,
  content TEXT,
  channel VARCHAR(20) NOT NULL,            -- IN_APP, TELEGRAM, EMAIL
  is_read BOOLEAN DEFAULT false,
  sent_at TIMESTAMP DEFAULT NOW()
);
```

---

## 6. API 설계

### 6.1 Next.js API Routes

#### 종목 관련

| Method | Endpoint                         | 설명               |
| ------ | -------------------------------- | ------------------ |
| GET    | `/api/stocks/search?q=`          | 종목 검색          |
| GET    | `/api/stocks/[code]`             | 종목 상세 정보     |
| GET    | `/api/stocks/[code]/disclosures` | 종목별 공시 목록   |
| GET    | `/api/stocks/[code]/financials`  | 종목별 재무 데이터 |

#### 관심 종목 관련

| Method | Endpoint              | 설명                |
| ------ | --------------------- | ------------------- |
| GET    | `/api/watchlist`      | 내 관심 종목 목록   |
| POST   | `/api/watchlist`      | 관심 종목 추가      |
| PUT    | `/api/watchlist/[id]` | 관심 종목 설정 수정 |
| DELETE | `/api/watchlist/[id]` | 관심 종목 삭제      |

#### 공시 관련

| Method | Endpoint                  | 설명                    |
| ------ | ------------------------- | ----------------------- |
| GET    | `/api/disclosures`        | 전체 공시 목록 (필터링) |
| GET    | `/api/disclosures/[id]`   | 공시 상세 + AI 분석     |
| GET    | `/api/disclosures/recent` | 관심 종목 최근 공시     |

#### AI 관련

| Method | Endpoint                               | 설명                |
| ------ | -------------------------------------- | ------------------- |
| POST   | `/api/ai/report/[code]`                | AI 리포트 생성 요청 |
| GET    | `/api/ai/report/[code]`                | AI 리포트 조회      |
| POST   | `/api/ai/chat`                         | AI 질문하기         |
| GET    | `/api/ai/conversations/[disclosureId]` | 대화 내역 조회      |

#### 알림 관련

| Method | Endpoint                       | 설명           |
| ------ | ------------------------------ | -------------- |
| GET    | `/api/notifications`           | 알림 목록      |
| PUT    | `/api/notifications/[id]/read` | 알림 읽음 처리 |

### 6.2 n8n Webhook

| Endpoint                      | 설명               | 트리거          |
| ----------------------------- | ------------------ | --------------- |
| `/webhook/dart/poll`          | 새 공시 체크       | 매 5분          |
| `/webhook/dart/analyze`       | 공시 AI 분석       | 새 공시 감지 시 |
| `/webhook/report/generate`    | AI 리포트 생성     | 사용자 요청 시  |
| `/webhook/notify/telegram`    | 텔레그램 알림 발송 | AI 분석 완료 시 |
| `/webhook/notify/email/daily` | 일일 이메일 리포트 | 매일 오후 6시   |

---

## 7. DART API 활용

### 7.1 사용할 DART API 목록

| API                    | 용도                    |
| ---------------------- | ----------------------- |
| 공시목록 조회          | 최근 공시 목록 가져오기 |
| 기업개황 조회          | 기업 기본 정보          |
| 공시서류원본           | 공시 원문 (XML)         |
| 단일회사 전체 재무제표 | 재무상태표, 손익계산서  |
| 배당에 관한 사항       | 배당 정보               |
| 최대주주 현황          | 지분 정보               |
| 임원 현황              | 임원 정보               |

### 7.2 공시 폴링 로직

```
[5분마다 실행]
    ↓
[DART API] 최근 공시 목록 조회 (최근 1시간)
    ↓
[필터링] 관심 종목 공시만 추출
    ↓
[중복 체크] DB에 이미 있는 공시 제외
    ↓
[새 공시 있음?]
    ├─ Yes → [AI 분석 요청] → [DB 저장] → [알림 발송]
    └─ No  → 종료
```

---

## 8. AI 프롬프트 설계

### 8.1 공시 3줄 요약 + 호재/악재 판단

```
당신은 주식 투자 전문가입니다.
아래 공시 내용을 분석하여 개인 투자자가 이해하기 쉽게 해석해주세요.

## 공시 정보
- 기업명: {corp_name}
- 공시 유형: {report_type}
- 공시 내용:
{disclosure_content}

## 분석 요청
다음 형식으로 응답해주세요:

{
  "summary": [
    "첫 번째 핵심 포인트",
    "두 번째 핵심 포인트",
    "세 번째 핵심 포인트"
  ],
  "sentiment": "호재" | "악재" | "중립",
  "sentiment_reason": "판단 근거 한 문장",
  "key_figures": [
    {"label": "매출액", "value": "74조원", "change": "+12%"},
    {"label": "영업이익", "value": "6.5조원", "change": "+45%"}
  ],
  "terms": [
    {"term": "유상증자", "explanation": "회사가 새 주식을 발행해서 돈을 모으는 것"}
  ]
}

## 지침
- 전문 용어는 쉽게 풀어서 설명
- 숫자는 구체적으로 제시
- 투자자 관점에서 중요한 정보 위주로
- 호재/악재 판단은 단기 주가 영향 기준
```

### 8.2 기업 분석 리포트 생성

```
당신은 증권사 애널리스트입니다.
아래 기업의 재무 데이터를 분석하여 투자 리포트를 작성해주세요.

## 기업 정보
- 기업명: {corp_name}
- 업종: {sector}
- 설립일: {est_dt}

## 재무 데이터 (최근 4분기)
{financial_data}

## 최대주주 현황
{major_shareholders}

## 최근 주요 공시
{recent_disclosures}

## 리포트 작성 요청
다음 항목을 포함하여 리포트를 작성해주세요:

{
  "company_overview": "기업 개요 2-3문장",
  "financial_analysis": {
    "revenue_trend": "매출 추이 분석",
    "profitability": "수익성 분석 (영업이익률, ROE 등)",
    "stability": "안정성 분석 (부채비율, 유동비율 등)",
    "growth": "성장성 분석"
  },
  "dividend_analysis": "배당 분석 (배당수익률, 배당성향)",
  "risk_factors": ["리스크 요인 1", "리스크 요인 2"],
  "investment_points": ["투자 포인트 1", "투자 포인트 2"],
  "ai_opinion": "AI 종합 의견 (3-4문장)"
}

## 지침
- 객관적인 데이터 기반 분석
- 긍정적/부정적 요소 균형 있게 서술
- 전문 용어는 괄호로 쉬운 설명 추가
- 투자 조언은 "~할 수 있다" 식의 가능성으로 표현
```

### 8.3 공시 질문 응답 (채팅)

```
당신은 친근한 주식 투자 도우미입니다.
사용자가 특정 공시에 대해 질문하면 쉽게 설명해주세요.

## 공시 정보
- 기업명: {corp_name}
- 공시 유형: {report_type}
- 공시 내용 요약: {summary}
- 핵심 수치: {key_figures}

## 대화 히스토리
{conversation_history}

## 사용자 질문
{user_question}

## 지침
- 반말로 친근하게 대화
- 어려운 용어는 비유로 설명
- 숫자는 구체적으로 제시
- 모르는 건 솔직히 모른다고 말하기
- 투자 판단은 사용자 몫임을 인지
- 2-3문단 이내로 간결하게 답변
```

---

## 9. n8n 워크플로우

### 9.1 공시 폴링 & 분석

```
[Schedule Trigger: 매 5분]
    ↓
[DART API: 공시목록 조회]
params: bgn_de (1시간 전), end_de (현재)
    ↓
[Supabase: 관심 종목 목록 조회]
    ↓
[Filter: 관심 종목 공시만]
    ↓
[Supabase: 기존 공시와 비교]
    ↓
[IF: 새 공시 있음?]
    │
    ├─ Yes ─→ [Loop: 각 공시에 대해]
    │              ↓
    │         [DART API: 공시 원문 조회]
    │              ↓
    │         [Gemini API: AI 분석]
    │              ↓
    │         [Supabase: 공시 + 분석 저장]
    │              ↓
    │         [Supabase: 알림 대상 조회]
    │              ↓
    │         [IF: 텔레그램 알림 ON?]
    │         ├─ Yes → [Telegram: 메시지 발송]
    │         └─ No  → Skip
    │              ↓
    │         [Supabase: 알림 기록 저장]
    │
    └─ No ──→ [종료]
```

### 9.2 AI 리포트 생성

```
[Webhook: /report/generate]
body: { stock_code, user_id }
    ↓
[Supabase: 기업 정보 조회]
    ↓
[DART API: 재무제표 조회 (최근 4분기)]
    ↓
[DART API: 최대주주 현황 조회]
    ↓
[DART API: 배당 정보 조회]
    ↓
[Supabase: 최근 공시 목록 조회]
    ↓
[Gemini API: 리포트 생성]
    ↓
[Supabase: 리포트 저장]
    ↓
[Response: 리포트 ID 반환]
```

### 9.3 일일 이메일 리포트

```
[Schedule Trigger: 매일 18:00]
    ↓
[Supabase: 이메일 알림 ON 사용자 조회]
    ↓
[Loop: 각 사용자에 대해]
    ↓
[Supabase: 오늘 해당 사용자 관심 종목 공시 조회]
    ↓
[IF: 공시 있음?]
    │
    ├─ Yes ─→ [Gemini API: 일일 요약 생성]
    │              ↓
    │         [Email: 리포트 발송]
    │
    └─ No ──→ Skip
```

---

## 10. 개발 일정 (MVP)

### Phase 1: 기반 구축 (1주)

- [ ] 프로젝트 셋업 (Next.js + Supabase)
- [ ] DART API 연동 테스트
- [ ] 인증 구현 (이메일, 구글, 카카오)
- [ ] 기본 레이아웃 + 네비게이션

### Phase 2: 핵심 기능 (2주)

- [ ] 종목 검색 기능
- [ ] 관심 종목 CRUD
- [ ] 공시 목록 조회 (DART 연동)
- [ ] 대시보드 구현

### Phase 3: AI 기능 (2주)

- [ ] n8n 공시 폴링 워크플로우
- [ ] Gemini API 연동
- [ ] 공시 AI 해석 기능
- [ ] AI 기업 분석 리포트
- [ ] AI 질문하기 (채팅)

### Phase 4: 알림 & 마무리 (1주)

- [ ] 텔레그램 봇 연동
- [ ] 이메일 알림 구현
- [ ] AWS EC2 배포
- [ ] 테스트 및 버그 수정

**총 예상 기간: 6주**

---

## 11. 향후 확장 가능성

- 📊 동종 업계 비교 분석
- 📈 재무제표 시각화 (차트)
- 🔔 카카오톡 알림 추가
- 📱 모바일 앱 (React Native)
- 🤝 리포트 공유 기능
- 💰 프리미엄 기능 (무제한 종목, 상세 리포트)

---

## 부록: DART 공시 유형 코드

| 코드 | 유형         | 설명                                  |
| ---- | ------------ | ------------------------------------- |
| A    | 정기보고서   | 사업보고서, 분기/반기보고서           |
| B    | 주요사항보고 | 주요경영사항 신고                     |
| C    | 발행공시     | 증권신고서, 투자설명서                |
| D    | 지분공시     | 주식등의 대량보유, 임원/주요주주 보고 |
| E    | 기타공시     | 자기주식, 합병, 분할 등               |
| F    | 외부감사     | 감사보고서                            |
| G    | 펀드공시     | 집합투자기구                          |
| H    | 자산유동화   | 자산유동화증권                        |
| I    | 거래소공시   | 한국거래소 신고                       |
